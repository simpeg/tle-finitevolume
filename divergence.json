{"kind":"Notebook","sha256":"9e1b0df1d19263f10d5c92a8d60bcf3cfa0ec9875cc554a05fdc98f17378d9f1","slug":"divergence","dependencies":[],"frontmatter":{"title":"Divergence Operator","authors":[{"name":"Rowan Cockett","orcid":"0000-0002-7859-8394","corresponding":true,"email":"rowan@curvenote.com","affiliations":["University of British Columbia"]},{"name":"Lindsey Heagy","orcid":"0000-0002-1551-5926","affiliations":["University of British Columbia"]},{"name":"Douglas Oldenburg","orcid":"0000-0002-4327-2124","affiliations":["University of British Columbia"]}],"date":"2016/08/01","doi":"10.1190/tle35080703.1","open_access":true,"license":{"content":{"id":"CC-BY-SA-3.0","name":"Creative Commons Attribution Share Alike 3.0 Unported","CC":true,"url":"https://creativecommons.org/licenses/by-sa/3.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"github":"https://github.com/simpeg/tle-finitevolume","subject":"tutorial","venue":{"title":"The Leading Edge"},"thumbnail":"/tle-finitevolume/build/divergence-2c806104cbc6153b81eae599a0617138.png","exports":[{"format":"ipynb","filename":"divergence.ipynb","url":"/tle-finitevolume/build/divergence-fe63a898e01b693b93d94798008c709f.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":0,"column":0},"end":{"line":1,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":0},"end":{"line":5,"column":0}},"children":[{"type":"text","value":"The divergence is the integral of a flux through a closed surface as that enclosed volume shrinks to a point. Since we have discretized and no longer have continuous functions, we cannot fully take the limit to a point; instead, we approximate it around some (finite!) volume: ","key":"NcZ9R1zZ52"},{"type":"emphasis","children":[{"type":"text","value":"a cell","key":"BfzlvoyCys"}],"key":"Cy4gqK0b3c"},{"type":"text","value":". The flux out of the surface (","key":"sKT4oEK2Ut"},{"type":"inlineMath","value":"\\vec{j} \\cdot \\vec{n}","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent=\"true\"><mi>n</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{j} \\cdot \\vec{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.137em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">n</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>","key":"OaBflYp7BK"},{"type":"text","value":") is actually how we discretized ","key":"EhpFSWH7ab"},{"type":"inlineMath","value":"\\vec{j}","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.137em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"AYskp6qSpl"},{"type":"text","value":" onto our mesh (i.e. ","key":"M1jWp6k0tT"},{"type":"inlineMath","value":"\\bf{j}","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">j</mi></mrow><annotation encoding=\"application/x-tex\">\\bf{j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbf\">j</span></span></span></span></span></span>","key":"wOwxdrTQtn"},{"type":"text","value":") except that the face normal points out of the cell (rather than in the axes direction). After fixing the direction of the face normal (multiplying by ","key":"EudKDmDOAa"},{"type":"inlineMath","value":"\\pm 1","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>±</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\pm 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">±</span><span class=\"mord\">1</span></span></span></span>","key":"WqtxRajBhP"},{"type":"text","value":"), we only need to calculate the face areas and cell volume to create the discrete divergence matrix.","key":"QaY2mIF9Ni"}],"key":"AKYpS5lyj3"}],"data":{"id":"nb-cell-0","type":"notebook-content","iooxa":{"id":{"block":"nKfiCCQl0i4NxAg9AUPc","project":"5dxSs15hZtvQDKSzFgjP","version":3}}},"identifier":"nb-cell-0","label":"nb-cell-0","html_id":"nb-cell-0","key":"DGDPUOmmZv"},{"type":"block","position":{"start":{"line":6,"column":0},"end":{"line":7,"column":0}},"children":[{"type":"heading","depth":1,"position":{"start":{"line":8,"column":0},"end":{"line":9,"column":0}},"children":[{"type":"text","value":"Building our operators: the Face Divergence","key":"NfcBDpUMMN"}],"identifier":"building-our-operators-the-face-divergence","label":"Building our operators: the Face Divergence","html_id":"building-our-operators-the-face-divergence","implicit":true,"key":"eJk8TzWRX5"},{"type":"container","kind":"figure","identifier":"22570c81","label":"22570c81","children":[{"type":"image","url":"/tle-finitevolume/build/divergence-2c806104cbc6153b81eae599a0617138.png","alt":"Geometrical definition of the divergence and the discretization.","urlSource":"../images/divergence.png","key":"bIC5OTm3LU"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":12,"column":0},"end":{"line":13,"column":0}},"children":[{"type":"captionNumber","kind":"figure","label":"22570c81","identifier":"22570c81","html_id":"id-22570c81","enumerator":"1","children":[{"type":"text","value":"Figure ","key":"OjkosOMKai"},{"type":"text","value":"1","key":"edE9OYzo1g"},{"type":"text","value":":","key":"edHCjSbMIW"}],"template":"Figure %s:","key":"IlAoRTkcqx"},{"type":"text","value":"Geometrical definition of the divergence and the discretization.","key":"ZhHlTMYeCP"}],"key":"aAuO8KFBO9"}],"key":"t1TCg7Psm8"}],"enumerator":"1","html_id":"id-22570c81","key":"OtinePHDL3"}],"data":{"id":"nb-cell-1","type":"notebook-content","iooxa":{"id":{"block":"oOiLGQcS0svLOalNSTf1","project":"5dxSs15hZtvQDKSzFgjP","version":2}}},"identifier":"nb-cell-1","label":"nb-cell-1","html_id":"nb-cell-1","key":"xJ9zcRF0YZ"},{"type":"block","position":{"start":{"line":15,"column":0},"end":{"line":16,"column":0}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":17,"column":0},"end":{"line":18,"column":0}},"children":[{"type":"text","value":"Implementation","key":"Wt0bPfpXtW"}],"identifier":"implementation","label":"Implementation","html_id":"implementation","implicit":true,"key":"n4AG60ZBJl"},{"type":"paragraph","position":{"start":{"line":19,"column":0},"end":{"line":20,"column":0}},"children":[{"type":"text","value":"Although this is a really helpful way to think about conceptually what is happening, the implementation of that would be a huge for loop over each cell. In practice, this would be slow, so instead, we will take advantage of linear algebra. Let's start by looking at this in 1 dimension using the SimPEG Mesh class.","key":"kCrTHpooYX"}],"key":"QL0mRn1Ufw"}],"data":{"id":"nb-cell-2","type":"notebook-content","iooxa":{"id":{"block":"eeAxDflDGPkdOrAgHuuc","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-2","label":"nb-cell-2","html_id":"nb-cell-2","key":"c3eshQOFiR"},{"type":"block","position":{"start":{"line":21,"column":0},"end":{"line":22,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport discretize\nimport matplotlib.pyplot as plt","identifier":"nb-cell-3-code","enumerator":"1","html_id":"nb-cell-3-code","key":"ezzxobIfyo"},{"type":"output","id":"SFnNkb_j75Oo5HvCrL6oU","data":[],"identifier":"nb-cell-3-output","html_id":"nb-cell-3-output","key":"ewM1vmAHvU"}],"data":{"id":"nb-cell-3","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"I4kyvafNPwP1ceD3UYe2","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"OPes5mhyogExjjUGG60P","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-3","label":"nb-cell-3","html_id":"nb-cell-3","key":"Z2wPmpynp4"},{"type":"block","position":{"start":{"line":33,"column":0},"end":{"line":34,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"# define a 1D mesh\nmesh1D = discretize.TensorMesh([5]) # with 5 cells \n\nfig, ax = plt.subplots(1,1, figsize=(12,2))\nax.plot(mesh1D.gridN, np.zeros(mesh1D.nN),'-k',marker='|',markeredgewidth=2, markersize=16)\nax.plot(mesh1D.gridCC,np.zeros(mesh1D.nC),'o')\nax.plot(mesh1D.gridFx,np.zeros(mesh1D.nFx),'>')\nax.set_title('1D Mesh');","identifier":"nb-cell-4-code","enumerator":"2","html_id":"nb-cell-4-code","key":"ayHvyyjB4P"},{"type":"output","id":"2awp6c2J1L5-CDooN1sBu","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"4b8525d131dba995667574f2e6f1633d","path":"/tle-finitevolume/build/4b8525d131dba995667574f2e6f1633d.png"},"text/plain":{"content":"<Figure size 864x144 with 1 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-4-output","html_id":"nb-cell-4-output","key":"OeeZIY8IU1"}],"data":{"id":"nb-cell-4","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"KrMUDYN80yajASOjw6E6","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"FJli27YyFqCTAPfsq6O2","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-4","label":"nb-cell-4","html_id":"nb-cell-4","key":"RqCsMso9LS"},{"type":"block","position":{"start":{"line":50,"column":0},"end":{"line":51,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"# and define a vector of fluxes that live on the faces of the 1D mesh\nface_vec = np.r_[0., 1., 2., 2., 1., 0.]  # vector of fluxes that live on the faces of the mesh\nprint(\"The flux on the faces is {}\".format(face_vec))\n\nplt.plot(mesh1D.gridFx, face_vec, '-o')\nplt.ylim([face_vec.min()-0.5, face_vec.max()+0.5])\nplt.grid(which='both')\nplt.title('face_vec');","identifier":"nb-cell-5-code","enumerator":"3","html_id":"nb-cell-5-code","key":"p1bdHkCARH"},{"type":"output","id":"bHY7EyGHI4IOsN5NnMyIa","data":[{"name":"stdout","output_type":"stream","text":"The flux on the faces is [0. 1. 2. 2. 1. 0.]\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"0be4c56de9218e1f29926ecfeab4ecdf","path":"/tle-finitevolume/build/0be4c56de9218e1f29926ecfeab4ecdf.png"},"text/plain":{"content":"<Figure size 432x288 with 1 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-5-output","html_id":"nb-cell-5-output","key":"kzgAaE9yvN"}],"data":{"id":"nb-cell-5","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"UcEj2TwHUfsKCmWOD9bH","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"aJK46VMEGjhwbzauXeEX","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-5","label":"nb-cell-5","html_id":"nb-cell-5","key":"lAc8U2yeS2"},{"type":"block","position":{"start":{"line":67,"column":0},"end":{"line":68,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":69,"column":0},"end":{"line":70,"column":0}},"children":[{"type":"text","value":"Over a single cell, the divergence is","key":"eIfv0GpE3l"}],"key":"AalAn6b7Ux"},{"type":"math","value":"\\nabla \\cdot \\vec{j}(p) = \\lim_{v \\to \\{p\\}} = \\int \\int_{S(v)} \\frac{\\vec{j}\\cdot \\vec{n}}{v} dS","position":{"start":{"line":71,"column":0},"end":{"line":74,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"normal\">∇</mi><mo>⋅</mo><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover><mo stretchy=\"false\">(</mo><mi>p</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munder><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>v</mi><mo>→</mo><mo stretchy=\"false\">{</mo><mi>p</mi><mo stretchy=\"false\">}</mo></mrow></munder><mo>=</mo><mo>∫</mo><msub><mo>∫</mo><mrow><mi>S</mi><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></msub><mfrac><mrow><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent=\"true\"><mi>n</mi><mo>⃗</mo></mover></mrow><mi>v</mi></mfrac><mi>d</mi><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">\\nabla \\cdot \\vec{j}(p) = \\lim_{v \\to \\{p\\}} = \\int \\int_{S(v)} \\frac{\\vec{j}\\cdot \\vec{n}}{v} dS</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">∇</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1925em;vertical-align:-0.25em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">p</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6604em;vertical-align:-0.966em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-2.309em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mrel mtight\">→</span><span class=\"mopen mtight\">{</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mclose mtight\">}</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">lim</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.966em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7065em;vertical-align:-1.0869em;\"></span><span class=\"mop op-symbol large-op\" style=\"margin-right:0.44445em;position:relative;top:-0.0011em;\">∫</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol large-op\" style=\"margin-right:0.44445em;position:relative;top:-0.0011em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:-0.3869em;\"><span style=\"top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0869em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6195em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">n</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span></span>","enumerator":"1","key":"iPsVkqcqWO"},{"type":"paragraph","position":{"start":{"line":75,"column":0},"end":{"line":76,"column":0}},"children":[{"type":"text","value":"in 1D, this collapses to taking a single difference - how much is going out of the cell vs coming in?","key":"Rk1UIpkIpI"}],"key":"L1LmIhqgZs"},{"type":"math","value":"\\nabla \\cdot \\vec{j} \\approx \\frac{1}{v}(-j_{\\text{left}} + j_{\\text{right}})","position":{"start":{"line":77,"column":0},"end":{"line":80,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"normal\">∇</mi><mo>⋅</mo><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover><mo>≈</mo><mfrac><mn>1</mn><mi>v</mi></mfrac><mo stretchy=\"false\">(</mo><mo>−</mo><msub><mi>j</mi><mtext>left</mtext></msub><mo>+</mo><msub><mi>j</mi><mtext>right</mtext></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\nabla \\cdot \\vec{j} \\approx \\frac{1}{v}(-j_{\\text{left}} + j_{\\text{right}})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">∇</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.137em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">left</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">right</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"2","key":"fIqE9jpGGM"},{"type":"paragraph","position":{"start":{"line":81,"column":0},"end":{"line":82,"column":0}},"children":[{"type":"text","value":"Since the normal of the x-face on the left side of the cell points in the positive x-direction, we multiply by -1 to get the flux going out of the cell. On the right, the normal defining the x-face is point out of the cell, so it is positive.","key":"SOFYwZRU1Q"}],"key":"mV9nXTsvH6"}],"data":{"id":"nb-cell-6","type":"notebook-content","iooxa":{"id":{"block":"yHXAjkwmvv2aYeV5xAaX","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-6","label":"nb-cell-6","html_id":"nb-cell-6","key":"MXVNM7958j"},{"type":"block","position":{"start":{"line":83,"column":0},"end":{"line":84,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"# We can take the divergence over the entire mesh by looping over each cell\ndiv_face_vec = np.zeros(mesh1D.nC) # allocate for each cell\n\nfor i in range(mesh1D.nC):  #  loop over each cell and \n    div_face_vec[i] = 1.0/mesh1D.cell_volumes[i] * (-face_vec[i] + face_vec[i+1])\n\nprint(\"The face div of the 1D flux is {}\".format(div_face_vec))","identifier":"nb-cell-7-code","enumerator":"4","html_id":"nb-cell-7-code","key":"kBKdkaz2TO"},{"type":"output","id":"rSpuRBx2loW4snOPSMfOW","data":[{"name":"stdout","output_type":"stream","text":"The face div of the 1D flux is [ 5.  5.  0. -5. -5.]\n"}],"identifier":"nb-cell-7-output","html_id":"nb-cell-7-output","key":"uzhXWGCFD5"}],"data":{"id":"nb-cell-7","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"XgNg21eJlh2qjEpr1jlV","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"mdoDntxjoU1cWAVwSBkA","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-7","label":"nb-cell-7","html_id":"nb-cell-7","key":"szpd7JB4eB"},{"type":"block","position":{"start":{"line":99,"column":0},"end":{"line":100,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":101,"column":0},"end":{"line":104,"column":0}},"children":[{"type":"text","value":"Doing it as a for loop is easy to program for the first time,\nbut is difficult to see what is going on and could be slow!\nInstead, we can build a face_divergence matrix (note: this is a silly way to do this!)","key":"yuKZYGVdvI"}],"key":"qtChRFGXY7"}],"data":{"id":"nb-cell-8","type":"notebook-content","iooxa":{"id":{"block":"s9P8ct5qaxTQtPLZeVZy","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-8","label":"nb-cell-8","html_id":"nb-cell-8","key":"Gjy3AnMpkh"},{"type":"block","position":{"start":{"line":105,"column":0},"end":{"line":106,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"face_divergence = np.zeros([mesh1D.nC, mesh1D.nF]) # allocate space for a face div matrix\nfor i in range(mesh1D.nC):  #  loop over each cell\n    face_divergence[i, [i, i+1]] = 1.0/mesh1D.cell_volumes[i] * np.r_[-1,+1]\n\nprint(\"The 1D face div matrix for this mesh is \\n{}\".format(face_divergence))\n\nassert np.all(face_divergence.dot(face_vec) == div_face_vec)  # make sure we get the same result! \n\nprint(\"\\nThe face div of the 1D flux is still {}!\".format(div_face_vec))","identifier":"nb-cell-9-code","enumerator":"5","html_id":"nb-cell-9-code","key":"sjprz5qYp5"},{"type":"output","id":"1H2eCp80kSwtJtz6OIzNe","data":[{"name":"stdout","output_type":"stream","text":"The 1D face div matrix for this mesh is \n[[-5.  5.  0.  0.  0.  0.]\n [ 0. -5.  5.  0.  0.  0.]\n [ 0.  0. -5.  5.  0.  0.]\n [ 0.  0.  0. -5.  5.  0.]\n [ 0.  0.  0.  0. -5.  5.]]\n\nThe face div of the 1D flux is still [ 5.  5.  0. -5. -5.]!\n"}],"identifier":"nb-cell-9-output","html_id":"nb-cell-9-output","key":"OYAP9ngtBK"}],"data":{"id":"nb-cell-9","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"Od46G6oAgVqe5C4GpGj2","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"cvVzOufBCzk8UqaCt95m","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-9","label":"nb-cell-9","html_id":"nb-cell-9","key":"n1MwLN2i3o"},{"type":"block","position":{"start":{"line":123,"column":0},"end":{"line":124,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":125,"column":0},"end":{"line":127,"column":0}},"children":[{"type":"text","value":"the above is still a loop... (and python is not a fan of loops).\nAlso, if the mesh gets big, we are storing a lot of unnecessary zeros","key":"JyLxzGoAD3"}],"key":"wQuU8SVJkx"}],"data":{"id":"nb-cell-10","type":"notebook-content","iooxa":{"id":{"block":"jdq8u8dXJLTkpsiu0UxF","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-10","label":"nb-cell-10","html_id":"nb-cell-10","key":"VzWHofcS19"},{"type":"block","position":{"start":{"line":128,"column":0},"end":{"line":129,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"There are {nnz} zeros (too many!) that we are storing\".format(nnz = np.sum(face_divergence == 0)))","identifier":"nb-cell-11-code","enumerator":"6","html_id":"nb-cell-11-code","key":"BKTfRWqX7R"},{"type":"output","id":"ZIGgbUtDFX2t5sB_7z3PZ","data":[{"name":"stdout","output_type":"stream","text":"There are 20 zeros (too many!) that we are storing\n"}],"identifier":"nb-cell-11-output","html_id":"nb-cell-11-output","key":"swbCmfoMdV"}],"data":{"id":"nb-cell-11","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"n29rX9nI47rDtXmSMEr0","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"hPm8VXETlzJiwxo7OpkT","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-11","label":"nb-cell-11","html_id":"nb-cell-11","key":"WmnwmP79WK"},{"type":"block","position":{"start":{"line":138,"column":0},"end":{"line":139,"column":0}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":140,"column":0},"end":{"line":141,"column":0}},"children":[{"type":"text","value":"Working in Sparse","key":"nXKJBIqF4X"}],"identifier":"working-in-sparse","label":"Working in Sparse","html_id":"working-in-sparse","implicit":true,"key":"PUZwkolkxr"},{"type":"paragraph","position":{"start":{"line":142,"column":0},"end":{"line":143,"column":0}},"children":[{"type":"text","value":"We will use instead ","key":"zgH5L1B43n"},{"type":"emphasis","children":[{"type":"text","value":"sparse","key":"s8NY2NQ6LE"}],"key":"RDaj3W1hI1"},{"type":"text","value":" matrices instead. These are in scipy and act almost the same as numpy arrays (except they default to matrix multiplication), and they don't store all of those pesky zeros! We use ","key":"PoTnntaFt5"},{"type":"link","url":"http://docs.scipy.org/doc/scipy/reference/sparse.html","children":[{"type":"text","value":"scipy.sparse","key":"ntkr8q1oqK"}],"urlSource":"http://docs.scipy.org/doc/scipy/reference/sparse.html","key":"FExOWkZ0Vm"},{"type":"text","value":" to build these matrices.","key":"wCMmmkbzv1"}],"key":"Bux6Mk2gBf"}],"data":{"id":"nb-cell-12","type":"notebook-content","iooxa":{"id":{"block":"Pgf0tUa8m83skvdq6xZV","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-12","label":"nb-cell-12","html_id":"nb-cell-12","key":"d4Fe4Ot5t5"},{"type":"block","position":{"start":{"line":144,"column":0},"end":{"line":145,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nfrom SimPEG.utils import sdiag # we are often building sparse diagonal matrices, so we made a functio in SimPEG!","identifier":"nb-cell-13-code","enumerator":"7","html_id":"nb-cell-13-code","key":"cxVrUKpmXi"},{"type":"output","id":"vDfAMCXWK3DhQ6YscP3Af","data":[],"identifier":"nb-cell-13-output","html_id":"nb-cell-13-output","key":"fNuDM1sNKG"}],"data":{"id":"nb-cell-13","type":"notebook-code","collapsed":true,"iooxa":{"id":{"block":"iggGtG34OkkLiEZWqRBp","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"0fWydswneLLXMcOTdGrA","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":true}},"identifier":"nb-cell-13","label":"nb-cell-13","html_id":"nb-cell-13","key":"XpieKRVtni"},{"type":"block","position":{"start":{"line":155,"column":0},"end":{"line":156,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"# construct differencing matrix with diagonals -1, +1\nsparse_diff = sp.spdiags((np.ones((mesh1D.nC+1, 1))*[-1, 1]).T, [0, 1], mesh1D.nC, mesh1D.nC+1, format=\"csr\")\nprint(\"the sparse differencing matrix is \\n{}\".format(sparse_diff.todense()))\n\n# account for the volume\nface_divergence_sparse = sdiag(1./mesh1D.cell_volumes) * sparse_diff  # account for volume \nprint(\"\\n and the face divergence is \\n{}\".format(face_divergence_sparse.todense()))\n\nprint(\"\\n but now we are only storing {nnz} nonzeros\".format(nnz=face_divergence_sparse.nnz))\n\nassert np.all(face_divergence_sparse.dot(face_vec) == div_face_vec) \nprint(\"\\n and we get the same answer! {}\".format(face_divergence_sparse * face_vec))","identifier":"nb-cell-14-code","enumerator":"8","html_id":"nb-cell-14-code","key":"EeaNsJleIz"},{"type":"output","id":"J4kEEQ5M0HKFURyRpKFv1","data":[{"name":"stdout","output_type":"stream","text":"the sparse differencing matrix is \n[[-1.  1.  0.  0.  0.  0.]\n [ 0. -1.  1.  0.  0.  0.]\n [ 0.  0. -1.  1.  0.  0.]\n [ 0.  0.  0. -1.  1.  0.]\n [ 0.  0.  0.  0. -1.  1.]]\n\n and the face divergence is \n[[-5.  5.  0.  0.  0.  0.]\n [ 0. -5.  5.  0.  0.  0.]\n [ 0.  0. -5.  5.  0.  0.]\n [ 0.  0.  0. -5.  5.  0.]\n [ 0.  0.  0.  0. -5.  5.]]\n\n but now we are only storing 10 nonzeros\n\n and we get the same answer! [ 5.  5.  0. -5. -5.]\n"}],"identifier":"nb-cell-14-output","html_id":"nb-cell-14-output","key":"JhqnTJ7eLo"}],"data":{"id":"nb-cell-14","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"6mvD37V5OTVVZ0XgFQr0","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"lqI4a0hkpkh2upH2PC0y","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false},"scrolled":true},"identifier":"nb-cell-14","label":"nb-cell-14","html_id":"nb-cell-14","key":"ohTENHQLAx"},{"type":"block","position":{"start":{"line":176,"column":0},"end":{"line":177,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":178,"column":0},"end":{"line":179,"column":0}},"children":[{"type":"text","value":"In SimPEG, this is stored as the ","key":"CwUmv3m4fV"},{"type":"inlineCode","value":"face_divergence","key":"bUTdDiv2TY"},{"type":"text","value":" property on the mesh","key":"RRnmb4MRJg"}],"key":"HJSUCnyhMT"}],"data":{"id":"nb-cell-15","type":"notebook-content","iooxa":{"id":{"block":"bQe15fAHreSIeSmntSVV","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-15","label":"nb-cell-15","html_id":"nb-cell-15","key":"L8TNQbTnOx"},{"type":"block","position":{"start":{"line":180,"column":0},"end":{"line":181,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(mesh1D.face_divergence * face_vec) # and still gives us the same answer!","identifier":"nb-cell-16-code","enumerator":"9","html_id":"nb-cell-16-code","key":"SXpzvzyk9y"},{"type":"output","id":"SjAK5mDcgjTRsTF8Cjmmh","data":[{"name":"stdout","output_type":"stream","text":"[ 5.  5.  0. -5. -5.]\n"}],"identifier":"nb-cell-16-output","html_id":"nb-cell-16-output","key":"kRlBJzUq5m"}],"data":{"id":"nb-cell-16","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"zkTsSUdbmN0Mc0dt9hP0","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"ZxjsTpo462PV9SGcbUVb","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-16","label":"nb-cell-16","html_id":"nb-cell-16","key":"tYa03yFp9X"},{"type":"block","position":{"start":{"line":190,"column":0},"end":{"line":191,"column":0}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":192,"column":0},"end":{"line":193,"column":0}},"children":[{"type":"text","value":"Moving to 2D","key":"VDmqo3g4ny"}],"identifier":"moving-to-2d","label":"Moving to 2D","html_id":"moving-to-2d","implicit":true,"key":"xX6MgwA3Kx"}],"data":{"id":"nb-cell-17","type":"notebook-content","iooxa":{"id":{"block":"kdbZr5yVmhZnw1W6RbcY","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-17","label":"nb-cell-17","html_id":"nb-cell-17","key":"c0abJMpne0"},{"type":"block","position":{"start":{"line":194,"column":0},"end":{"line":195,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":196,"column":0},"end":{"line":197,"column":0}},"children":[{"type":"text","value":"To move up in dimensionality, we build a 2D mesh which has both x and y faces","key":"nvwIC5xJLL"}],"key":"TzuK7LNxNi"}],"data":{"id":"nb-cell-18","type":"notebook-content","iooxa":{"id":{"block":"Z7p6qywo3VYVsUFXBwiA","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-18","label":"nb-cell-18","html_id":"nb-cell-18","key":"tRRZvA4NPz"},{"type":"block","position":{"start":{"line":198,"column":0},"end":{"line":199,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"mesh2D = discretize.TensorMesh([100, 80])\nmesh2D.plot_grid()\nplt.axis('tight');","identifier":"nb-cell-19-code","enumerator":"10","html_id":"nb-cell-19-code","key":"IdjrlOzfqB"},{"type":"output","id":"doqG9gS4uOP6kEt6KzZRA","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"c163dfe4cc4be0504849a4c3cca57f4c","path":"/tle-finitevolume/build/c163dfe4cc4be0504849a4c3cca57f4c.png"},"text/plain":{"content":"<Figure size 432x288 with 1 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-19-output","html_id":"nb-cell-19-output","key":"vMlluKEKUh"}],"data":{"id":"nb-cell-19","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"ePmEVcPu45VaiZ4iySo2","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"Te1e50NOTpP1m84K6IOn","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-19","label":"nb-cell-19","html_id":"nb-cell-19","key":"vsQuZNtas6"},{"type":"block","position":{"start":{"line":210,"column":0},"end":{"line":211,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":212,"column":0},"end":{"line":213,"column":0}},"children":[{"type":"text","value":"We define 2 face functions, one in the x-direction and one in the y-direction. Here, we choose to work with sine functions as the continuous divergence is easy to compute, meaning we can test it!","key":"Eo4kVg5mG3"}],"key":"mERkav1AKM"}],"data":{"id":"nb-cell-20","type":"notebook-content","iooxa":{"id":{"block":"E3V1eLMjpPyWwJwhKs40","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-20","label":"nb-cell-20","html_id":"nb-cell-20","key":"PD4vLRADuA"},{"type":"block","position":{"start":{"line":214,"column":0},"end":{"line":215,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"jx_fct = lambda x, y: -np.sin(2.*np.pi*x)\njy_fct = lambda x, y: -np.sin(2.*np.pi*y)\n\njx_vec = jx_fct(mesh2D.gridFx[:,0], mesh2D.gridFx[:,1])\njy_vec = jy_fct(mesh2D.gridFy[:,0], mesh2D.gridFy[:,1])\n\nj_vec = np.r_[jx_vec, jy_vec]\n\nprint(\"There are {nFx} x-faces and {nFy} y-faces, so the length of the \"\n      \"face function, j, is {lenj}\".format(\n        nFx=mesh2D.nFx, \n        nFy=mesh2D.nFy,\n        lenj=len(j_vec)\n     ))\n\nplt.colorbar(mesh2D.plot_image(j_vec, 'F', view='vec')[0]);","identifier":"nb-cell-21-code","enumerator":"11","html_id":"nb-cell-21-code","key":"aPGJ6hn4Jc"},{"type":"output","id":"eyEE2gXMoMh6jsKTSX3La","data":[{"name":"stdout","output_type":"stream","text":"There are 8080 x-faces and 8100 y-faces, so the length of the face function, j, is 16180\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"c6900e9dffb779002ed5c80748635ad6","path":"/tle-finitevolume/build/c6900e9dffb779002ed5c80748635ad6.png"},"text/plain":{"content":"<Figure size 432x288 with 2 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-21-output","html_id":"nb-cell-21-output","key":"pdImjHIa8K"}],"data":{"id":"nb-cell-21","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"A1au7WuOH2jGDyuDba5t","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"1ipNn5keUvuAaL7RoUvb","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-21","label":"nb-cell-21","html_id":"nb-cell-21","key":"eBUyM5ICRm"},{"type":"block","position":{"start":{"line":239,"column":0},"end":{"line":240,"column":0}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":241,"column":0},"end":{"line":242,"column":0}},"children":[{"type":"text","value":"But first... what does the matrix look like?","key":"NMlfs5HSsa"}],"identifier":"but-first-what-does-the-matrix-look-like","label":"But first... what does the matrix look like?","html_id":"but-first-what-does-the-matrix-look-like","implicit":true,"key":"KdLXS1pRNl"},{"type":"paragraph","position":{"start":{"line":243,"column":0},"end":{"line":244,"column":0}},"children":[{"type":"text","value":"Now, we know that we do not want to loop over each of the cells and instead want to work with matrix-vector products. In this case, each row of the divergence matrix should pick out the two relevant faces in the x-direction and two in the y-direction (4 total).","key":"BLYbO4ecik"}],"key":"kJ07QRIzIf"},{"type":"paragraph","position":{"start":{"line":245,"column":0},"end":{"line":246,"column":0}},"children":[{"type":"text","value":"When we unwrap our face function, we unwrap using column major ordering, so all of the x-faces are adjacent to one another, while the y-faces are separated by the number of cells in the x-direction (see ","key":"GNAMtRyBA4"},{"type":"link","url":"/mesh","children":[{"type":"text","value":"Finite Volume Mesh","key":"hf2CJlOtee"}],"urlSource":"mesh.ipynb","internal":true,"dataUrl":"/mesh.json","protocol":"file","key":"wVowFLTZe4"},{"type":"text","value":" for more details!).","key":"M8efkZLLuk"}],"key":"jQMEqSMjcr"},{"type":"paragraph","position":{"start":{"line":247,"column":0},"end":{"line":248,"column":0}},"children":[{"type":"text","value":"When we plot the divergence matrix, there will be 4 \"diagonals\",","key":"ojDJkB8Jse"}],"key":"zc4J0lwYDo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":248,"column":0},"end":{"line":251,"column":0}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":248,"column":0},"end":{"line":249,"column":0}},"children":[{"type":"text","value":"2 that are due to the x-contribution","key":"WYA4OxT9ac"}],"key":"MGe2QCw4nc"},{"type":"listItem","spread":true,"position":{"start":{"line":249,"column":0},"end":{"line":251,"column":0}},"children":[{"type":"text","value":"2 that are due to the y-contribution","key":"WZ56bZIAJz"}],"key":"kSmv2tC2ii"}],"key":"Nlrmh2tBAf"},{"type":"paragraph","position":{"start":{"line":251,"column":0},"end":{"line":252,"column":0}},"children":[{"type":"text","value":"Here, we define a small 2D mesh so that it is easier to see the matrix structure.","key":"SOAtnNgTnZ"}],"key":"MUCzOxM7qN"}],"data":{"id":"nb-cell-22","type":"notebook-content","iooxa":{"id":{"block":"6USJcIPTF75SdDWAyvcC","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-22","label":"nb-cell-22","html_id":"nb-cell-22","key":"T74M6YCXQj"},{"type":"block","position":{"start":{"line":253,"column":0},"end":{"line":254,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"small_mesh2D = discretize.TensorMesh([3, 4])\n\nprint(\"Each y-face is {} entries apart\".format(small_mesh2D.shape_cells[0]))\nprint(\"and the total number of x-faces is {}\".format(small_mesh2D.nFx))\nprint(\"So in the first row of the face_divergence, we have non-zero entries at \\n{}\".format(\n        small_mesh2D.face_divergence[0,:]))","identifier":"nb-cell-23-code","enumerator":"12","html_id":"nb-cell-23-code","key":"HCMnDUzNkN"},{"type":"output","id":"MCt2a3lwCxW3sCQW_YKpf","data":[{"name":"stdout","output_type":"stream","text":"Each y-face is 3 entries apart\nand the total number of x-faces is 16\nSo in the first row of the face_divergence, we have non-zero entries at \n  (0, 0)\t-3.0\n  (0, 1)\t3.0\n  (0, 16)\t-4.0\n  (0, 19)\t4.0\n"}],"identifier":"nb-cell-23-output","html_id":"nb-cell-23-output","key":"Q63t610N6c"}],"data":{"id":"nb-cell-23","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"4XzIANGORIjDIJqUlgSW","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"hNs5MlCVEZ7kH7WL2hjA","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-23","label":"nb-cell-23","html_id":"nb-cell-23","key":"iUbum3wAlj"},{"type":"block","position":{"start":{"line":268,"column":0},"end":{"line":269,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":270,"column":0},"end":{"line":271,"column":0}},"children":[{"type":"text","value":"Now, lets look at the matrix structure","key":"IanP7GED1A"}],"key":"AJTmCtvYgl"}],"data":{"id":"nb-cell-24","type":"notebook-content","iooxa":{"id":{"block":"A5C1ITpQonG1NxgAZZqA","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-24","label":"nb-cell-24","html_id":"nb-cell-24","key":"nwlLuYX1vW"},{"type":"block","position":{"start":{"line":272,"column":0},"end":{"line":273,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1,2, figsize=(12,4))\n\n# plot the non-zero entries in the face_divergence\nax[0].spy(small_mesh2D.face_divergence, ms=2)\nax[0].set_xlabel('2D face_divergence')\nsmall_mesh2D.plot_grid(ax=ax[1])\n\n# Number the faces and plot. (We should really add this to SimPEG... pull request anyone!?)\nxys = zip(\n    small_mesh2D.gridFx[:,0], \n    small_mesh2D.gridFx[:,1], \n    range(small_mesh2D.nFx)\n)\nfor x,y,ii in xys:\n    ax[1].plot(x, y, 'r>')\n    ax[1].text(x+0.01, y-0.02, ii, color='r')\n\nxys = zip(\n    small_mesh2D.gridFy[:,0], \n    small_mesh2D.gridFy[:,1], \n    range(small_mesh2D.nFy)\n)\nfor x,y,ii in xys:\n    ax[1].plot(x, y, 'g^')\n    ax[1].text(x-0.02, y+0.02, ii+small_mesh2D.nFx, color='g')\nax[1].set_xlim((-0.1,1.1));\nax[1].set_ylim((-0.1,1.1));","identifier":"nb-cell-25-code","enumerator":"13","html_id":"nb-cell-25-code","key":"woKGDArabb"},{"type":"output","id":"UZA9q2K-sueEIGMILeU2s","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"bdf6f5e3df0535ee7815a8c69ad46f4d","path":"/tle-finitevolume/build/bdf6f5e3df0535ee7815a8c69ad46f4d.png"},"text/plain":{"content":"<Figure size 864x288 with 2 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-25-output","html_id":"nb-cell-25-output","key":"SKuRhhKeyv"}],"data":{"id":"nb-cell-25","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"NLQRlTUmkMSh6mbkNwWw","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"3UjOmeynUI8HvbP1r44x","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-25","label":"nb-cell-25","html_id":"nb-cell-25","key":"MuLHvRkvlV"},{"type":"block","position":{"start":{"line":308,"column":0},"end":{"line":309,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":310,"column":0},"end":{"line":312,"column":0}},"children":[{"type":"text","value":"How did we construct the matrix? - Kronecker products.\nThere is a handy identity that relates the vectorized face function to its matrix form (","key":"d75htEzpiv"},{"type":"link","url":"https://en.wikipedia.org/wiki/Vectorization_(mathematics)#Compatibility_with_Kronecker_products","children":[{"type":"text","value":"see Wikipedia","key":"gfhay8LxYE"}],"urlSource":"https://en.wikipedia.org/wiki/Vectorization_(mathematics)#Compatibility_with_Kronecker_products","data":{"page":"Vectorization_(mathematics)#Compatibility_with_Kronecker_products","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"c1GoBTYHvd"},{"type":"text","value":")","key":"wlbClxIzVk"}],"key":"HfigXSAUXf"},{"type":"math","value":"\\text{vec}(AUB^\\top) = (B \\otimes A) \\text{vec}(U)","position":{"start":{"line":313,"column":0},"end":{"line":316,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>vec</mtext><mo stretchy=\"false\">(</mo><mi>A</mi><mi>U</mi><msup><mi>B</mi><mi mathvariant=\"normal\">⊤</mi></msup><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>B</mi><mo>⊗</mo><mi>A</mi><mo stretchy=\"false\">)</mo><mtext>vec</mtext><mo stretchy=\"false\">(</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{vec}(AUB^\\top) = (B \\otimes A) \\text{vec}(U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1491em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">vec</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8991em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">⊤</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mord text\"><span class=\"mord\">vec</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"wCLDknzqNm"},{"type":"paragraph","position":{"start":{"line":317,"column":0},"end":{"line":318,"column":0}},"children":[{"type":"text","value":"For the x-contribution:","key":"RDcK7zlYDk"}],"key":"hmJp2cvJcG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":318,"column":0},"end":{"line":322,"column":0}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":318,"column":0},"end":{"line":319,"column":0}},"children":[{"type":"text","value":"A is our 1D differential operator ([-1, +1] on the diagonals)","key":"OeUWHWHpz7"}],"key":"OAx0D5hL0u"},{"type":"listItem","spread":true,"position":{"start":{"line":319,"column":0},"end":{"line":320,"column":0}},"children":[{"type":"text","value":"U is ","key":"VlFxuC8YRK"},{"type":"inlineMath","value":"j_x","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>j</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">j_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"DFLQHLbRZQ"},{"type":"text","value":" (the x-face function as a matrix)","key":"CGlnbiVTJe"}],"key":"rCvDsmNDJp"},{"type":"listItem","spread":true,"position":{"start":{"line":320,"column":0},"end":{"line":322,"column":0}},"children":[{"type":"text","value":"B is just an identity, so","key":"u3dwzC9BAc"}],"key":"AcpF0jqOuz"}],"key":"kjDGKYPkoK"},{"type":"math","value":"\\text{Div}_x \\text{vec}(j_x) = (I \\otimes Div_{1D}) \\text{vec}(j_x)","position":{"start":{"line":322,"column":0},"end":{"line":325,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mtext>Div</mtext><mi>x</mi></msub><mtext>vec</mtext><mo stretchy=\"false\">(</mo><msub><mi>j</mi><mi>x</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>I</mi><mo>⊗</mo><mi>D</mi><mi>i</mi><msub><mi>v</mi><mrow><mn>1</mn><mi>D</mi></mrow></msub><mo stretchy=\"false\">)</mo><mtext>vec</mtext><mo stretchy=\"false\">(</mo><msub><mi>j</mi><mi>x</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Div}_x \\text{vec}(j_x) = (I \\otimes Div_{1D}) \\text{vec}(j_x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord text\"><span class=\"mord\">vec</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord text\"><span class=\"mord\">vec</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"4","key":"QsqVKnZhjG"},{"type":"paragraph","position":{"start":{"line":326,"column":0},"end":{"line":327,"column":0}},"children":[{"type":"text","value":"For the y-contribution:","key":"LSLxwxsLNZ"}],"key":"nt8E85ZLQD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":327,"column":0},"end":{"line":331,"column":0}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":327,"column":0},"end":{"line":328,"column":0}},"children":[{"type":"text","value":"A is just an identity!","key":"fU8EDwO7Qs"}],"key":"LbUoZ35v3V"},{"type":"listItem","spread":true,"position":{"start":{"line":328,"column":0},"end":{"line":329,"column":0}},"children":[{"type":"text","value":"U is ","key":"byefSGZW6a"},{"type":"inlineMath","value":"j_y","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>j</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">j_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9456em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"eJK1hPmuMZ"},{"type":"text","value":" (the y-face function as a matrix)","key":"HzZiXKXqZj"}],"key":"IN3lPcbziT"},{"type":"listItem","spread":true,"position":{"start":{"line":329,"column":0},"end":{"line":331,"column":0}},"children":[{"type":"text","value":"B is our 1D differential operator ([-1, +1] on the diagonals), so","key":"y2cydkyrPz"}],"key":"IyDLvalOJk"}],"key":"VVETJQwZ3m"},{"type":"math","value":"\\text{Div}_y \\text{vec}(j_y) = (\\text{Div}_{1D} \\otimes I) \\text{vec}(j_y)","position":{"start":{"line":331,"column":0},"end":{"line":334,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mtext>Div</mtext><mi>y</mi></msub><mtext>vec</mtext><mo stretchy=\"false\">(</mo><msub><mi>j</mi><mi>y</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mtext>Div</mtext><mrow><mn>1</mn><mi>D</mi></mrow></msub><mo>⊗</mo><mi>I</mi><mo stretchy=\"false\">)</mo><mtext>vec</mtext><mo stretchy=\"false\">(</mo><msub><mi>j</mi><mi>y</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Div}_y \\text{vec}(j_y) = (\\text{Div}_{1D} \\otimes I) \\text{vec}(j_y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord text\"><span class=\"mord\">vec</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⊗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mclose\">)</span><span class=\"mord text\"><span class=\"mord\">vec</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"5","key":"DadXjdYdfU"},{"type":"math","value":"\\text{Div} \\cdot j  = \\text{Div}_x \\cdot j_x + \\text{Div}_y \\cdot j_y = [\\text{Div}_x, \\text{Div}_y] \\cdot [j_x; j_y]","position":{"start":{"line":335,"column":0},"end":{"line":338,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>Div</mtext><mo>⋅</mo><mi>j</mi><mo>=</mo><msub><mtext>Div</mtext><mi>x</mi></msub><mo>⋅</mo><msub><mi>j</mi><mi>x</mi></msub><mo>+</mo><msub><mtext>Div</mtext><mi>y</mi></msub><mo>⋅</mo><msub><mi>j</mi><mi>y</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mtext>Div</mtext><mi>x</mi></msub><mo separator=\"true\">,</mo><msub><mtext>Div</mtext><mi>y</mi></msub><mo stretchy=\"false\">]</mo><mo>⋅</mo><mo stretchy=\"false\">[</mo><msub><mi>j</mi><mi>x</mi></msub><mo separator=\"true\">;</mo><msub><mi>j</mi><mi>y</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Div} \\cdot j  = \\text{Div}_x \\cdot j_x + \\text{Div}_y \\cdot j_y = [\\text{Div}_x, \\text{Div}_y] \\cdot [j_x; j_y]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9456em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span></span>","enumerator":"6","key":"XNXkcR6fHZ"},{"type":"paragraph","position":{"start":{"line":339,"column":0},"end":{"line":340,"column":0}},"children":[{"type":"text","value":"And ","key":"gRaYXbJgw3"},{"type":"inlineMath","value":"j","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span>","key":"dr2fLaHEu2"},{"type":"text","value":" is just ","key":"MabJrift1C"},{"type":"inlineMath","value":"[j_x; j_y]","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><msub><mi>j</mi><mi>x</mi></msub><mo separator=\"true\">;</mo><msub><mi>j</mi><mi>y</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[j_x; j_y]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0572em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"w5KDXomDKI"},{"type":"text","value":", so we can horizontally stack ","key":"p249KZUgC4"},{"type":"inlineMath","value":"\\text{Div}_x","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mtext>Div</mtext><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\text{Div}_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"za6YxDNKq9"},{"type":"text","value":", ","key":"hxeUypLzkx"},{"type":"inlineMath","value":"\\text{Div}_y","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mtext>Div</mtext><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\text{Div}_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"nF0L8qSB7P"}],"key":"Ydq6YLechM"},{"type":"math","value":"\\text{Div} = [\\text{Div}_x, \\text{Div}_y]","position":{"start":{"line":341,"column":0},"end":{"line":344,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>Div</mtext><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mtext>Div</mtext><mi>x</mi></msub><mo separator=\"true\">,</mo><msub><mtext>Div</mtext><mi>y</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Div} = [\\text{Div}_x, \\text{Div}_y]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Div</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span></span>","enumerator":"7","key":"RI1Nr58dT9"},{"type":"paragraph","position":{"start":{"line":345,"column":0},"end":{"line":346,"column":0}},"children":[{"type":"text","value":"You can check this out in the SimPEG docs by running ","key":"BGC0BvbrQH"},{"type":"strong","children":[{"type":"text","value":"small_mesh2D.face_divergence??","key":"Tpn17ASqci"}],"key":"kxgahPzFEU"}],"key":"bJU3KF2ed5"}],"data":{"id":"nb-cell-26","type":"notebook-content","iooxa":{"id":{"block":"aOOlNZjNUZ7kdkfIFPHR","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-26","label":"nb-cell-26","html_id":"nb-cell-26","key":"Ji2wYcY2xF"},{"type":"block","position":{"start":{"line":347,"column":0},"end":{"line":348,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"# check out the code!\nsmall_mesh2D.face_divergence??","identifier":"nb-cell-27-code","enumerator":"14","html_id":"nb-cell-27-code","key":"SVkWjcJwVL"},{"type":"output","id":"Fxx5Nmqx1_yYIO_cFyJer","data":[{"name":"stdout","output_type":"stream","text":"\u001b[0;31mType:\u001b[0m        property\n\u001b[0;31mString form:\u001b[0m <property object at 0x7fd5e03cb450>\n\u001b[0;31mSource:\u001b[0m     \n\u001b[0;31m# small_mesh2D.face_divergence.fget\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m\u001b[0;34m@\u001b[0m\u001b[0mproperty\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m\u001b[0;32mdef\u001b[0m \u001b[0mface_divergence\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m    \u001b[0;32mif\u001b[0m \u001b[0mgetattr\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m\"_face_divergence\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m        \u001b[0;31m# Get the stencil of +1, -1's\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m        \u001b[0mD\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_face_divergence_stencil\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m        \u001b[0;31m# Compute areas of cell faces & volumes\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m        \u001b[0mS\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mface_areas\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m        \u001b[0mV\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcell_volumes\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m        \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_face_divergence\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0msdiag\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;36m1\u001b[0m \u001b[0;34m/\u001b[0m \u001b[0mV\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;34m*\u001b[0m \u001b[0mD\u001b[0m \u001b[0;34m*\u001b[0m \u001b[0msdiag\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mS\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\n\u001b[0;34m\u001b[0m    \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_face_divergence\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n"}],"identifier":"nb-cell-27-output","html_id":"nb-cell-27-output","key":"Fa0TfpxBez"}],"data":{"id":"nb-cell-27","type":"notebook-code","iooxa":{"id":{"block":"gSfEfpCYCXa6fYefRTmU","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"BrcTtus5S1kiLvRNa7jJ","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"tags":[]},"identifier":"nb-cell-27","label":"nb-cell-27","html_id":"nb-cell-27","key":"gU1jTpbi3X"},{"type":"block","position":{"start":{"line":358,"column":0},"end":{"line":359,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":360,"column":0},"end":{"line":361,"column":0}},"children":[{"type":"text","value":"Now that we have a discrete divergence, lets check out the divergence of  the face function we defined earlier.","key":"M89SS1bp1T"}],"key":"Mt0uMphuaS"}],"data":{"id":"nb-cell-28","type":"notebook-content","iooxa":{"id":{"block":"WHVVo3M2HmurIwDe2dIN","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-28","label":"nb-cell-28","html_id":"nb-cell-28","key":"ILwZ7rTZB5"},{"type":"block","position":{"start":{"line":362,"column":0},"end":{"line":363,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"Div_j = mesh2D.face_divergence * j_vec\n\nfig, ax = plt.subplots(1,2, figsize=(8,4))\nplt.colorbar(mesh2D.plot_image(j_vec, 'F', view='vec', ax=ax[0])[0],ax=ax[0])\nplt.colorbar(mesh2D.plot_image(Div_j, ax=ax[1])[0],ax=ax[1])\n\nax[0].set_title('j')\nax[1].set_title('Div j')\nplt.tight_layout()","identifier":"nb-cell-29-code","enumerator":"15","html_id":"nb-cell-29-code","key":"wqPWnmwHCK"},{"type":"output","id":"ZcfXrZgvNgjJrdT9ea4O4","data":[{"name":"stderr","output_type":"stream","text":"/opt/anaconda3/envs/simpeg/lib/python3.8/site-packages/discretize/base/base_tensor_mesh.py:785: FutureWarning: The zerosOutside keyword argument has been deprecated, please use zeros_outside. This will be removed in discretize 1.0.0\n  warnings.warn(\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"7f3fe3cc121ed536dcb954287558ae74","path":"/tle-finitevolume/build/7f3fe3cc121ed536dcb954287558ae74.png"},"text/plain":{"content":"<Figure size 576x288 with 4 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-29-output","html_id":"nb-cell-29-output","key":"lWrJHC712a"}],"data":{"id":"nb-cell-29","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"uB6q9kdjkk5V4tTHaBES","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"Nyo6g0fMndfudyB5W2gu","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-29","label":"nb-cell-29","html_id":"nb-cell-29","key":"HmGCvZXJwr"},{"type":"block","position":{"start":{"line":380,"column":0},"end":{"line":381,"column":0}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":382,"column":0},"end":{"line":383,"column":0}},"children":[{"type":"text","value":"Are we right??","key":"qQHkEEN0M2"}],"identifier":"are-we-right","label":"Are we right??","html_id":"are-we-right","implicit":true,"key":"fVRlQDCEeX"},{"type":"paragraph","position":{"start":{"line":384,"column":0},"end":{"line":385,"column":0}},"children":[{"type":"text","value":"Since we chose a simple function,","key":"BWI5yplflX"}],"key":"NKPO8NG7HY"},{"type":"math","value":"\\vec{j} = - \\sin(2\\pi x) \\hat{x} - \\sin(2\\pi y) \\hat{y}","position":{"start":{"line":386,"column":0},"end":{"line":389,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover><mo>=</mo><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mi>π</mi><mi>x</mi><mo stretchy=\"false\">)</mo><mover accent=\"true\"><mi>x</mi><mo>^</mo></mover><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mi>π</mi><mi>y</mi><mo stretchy=\"false\">)</mo><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{j} = - \\sin(2\\pi x) \\hat{x} - \\sin(2\\pi y) \\hat{y}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.137em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2222em;\"><span class=\"mord\">^</span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1944em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span></span>","enumerator":"8","key":"tpKk1BZeV5"},{"type":"paragraph","position":{"start":{"line":390,"column":0},"end":{"line":391,"column":0}},"children":[{"type":"text","value":"we know the continuous divergence...","key":"pu1AiJp82B"}],"key":"rRtA2pYGDj"},{"type":"math","value":"\\nabla \\cdot \\vec{j} = -2\\pi (\\cos(2\\pi x) + \\cos(2\\pi y))","position":{"start":{"line":392,"column":0},"end":{"line":395,"column":0}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"normal\">∇</mi><mo>⋅</mo><mover accent=\"true\"><mi>j</mi><mo>⃗</mo></mover><mo>=</mo><mo>−</mo><mn>2</mn><mi>π</mi><mo stretchy=\"false\">(</mo><mi>cos</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mi>π</mi><mi>x</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mi>π</mi><mi>y</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\nabla \\cdot \\vec{j} = -2\\pi (\\cos(2\\pi x) + \\cos(2\\pi y))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">∇</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.137em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9425em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.2285em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mopen\">(</span><span class=\"mop\">cos</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">cos</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">))</span></span></span></span></span>","enumerator":"9","key":"K6aWuxtbuW"},{"type":"paragraph","position":{"start":{"line":396,"column":0},"end":{"line":397,"column":0}},"children":[{"type":"text","value":"So lets plot it and take a look","key":"DcPW98eLDc"}],"key":"YqMlQZhCuQ"}],"data":{"id":"nb-cell-30","type":"notebook-content","iooxa":{"id":{"block":"hpGeTcYVG4GcvxPnI5jn","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-30","label":"nb-cell-30","html_id":"nb-cell-30","key":"JVYqHL7H9s"},{"type":"block","position":{"start":{"line":398,"column":0},"end":{"line":399,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"# from earlier\n# jx_fct = lambda x, y: -np.sin(2*np.pi*x)\n# jy_fct = lambda x, y: -np.sin(2*np.pi*y)\n\nsol = lambda x, y: -2*np.pi*(np.cos(2*np.pi*x)+np.cos(2*np.pi*y))\n\ncont_div_j = sol(mesh2D.gridCC[:,0], mesh2D.gridCC[:,1])\n\nDiv_j = mesh2D.face_divergence * j_vec\n\nfig, ax = plt.subplots(1,2, figsize=(8,4))\nplt.colorbar(mesh2D.plot_image(Div_j, ax=ax[0])[0],ax=ax[0])\nplt.colorbar(mesh2D.plot_image(cont_div_j, ax=ax[1])[0],ax=ax[1])\n\nax[0].set_title('Discrete Div j')\nax[1].set_title('Continuous Div j')\nplt.tight_layout()","identifier":"nb-cell-31-code","enumerator":"16","html_id":"nb-cell-31-code","key":"ZRGurfKVM7"},{"type":"output","id":"EFZ49BdZx_mpj4Cio4Pf9","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"7c3e9a987e08a8b6e0e067640246fa91","path":"/tle-finitevolume/build/7c3e9a987e08a8b6e0e067640246fa91.png"},"text/plain":{"content":"<Figure size 576x288 with 4 Axes>","content_type":"text/plain"}}}],"identifier":"nb-cell-31-output","html_id":"nb-cell-31-output","key":"XB8LY9RpqU"}],"data":{"id":"nb-cell-31","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"DruoQp4QpjwnURKR6vMr","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"ZvXZKlpkFYAPMPlPCXIz","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-31","label":"nb-cell-31","html_id":"nb-cell-31","key":"vulKVRMFBF"},{"type":"block","position":{"start":{"line":424,"column":0},"end":{"line":425,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":426,"column":0},"end":{"line":427,"column":0}},"children":[{"type":"text","value":"Those look similar! 🚀","key":"E56EMapvcJ"}],"key":"jrWNgqoHRO"}],"data":{"id":"nb-cell-32","type":"notebook-content","iooxa":{"id":{"block":"hhzUNnwy5dN5VX82zKDh","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-32","label":"nb-cell-32","html_id":"nb-cell-32","key":"kTFeBPad2r"},{"type":"block","position":{"start":{"line":428,"column":0},"end":{"line":429,"column":0}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":430,"column":0},"end":{"line":431,"column":0}},"children":[{"type":"text","value":"Order Test","key":"lG3xo2oEnp"}],"identifier":"order-test","label":"Order Test","html_id":"order-test","implicit":true,"key":"gQE61B8gEy"},{"type":"paragraph","position":{"start":{"line":432,"column":0},"end":{"line":433,"column":0}},"children":[{"type":"text","value":"We can do better than just an eye-ball comparison - since we are using a a staggered grid, with centered differences, the discretization should be second-order (","key":"MK5wYFPLf6"},{"type":"inlineMath","value":"\\mathcal{O}(h^2)","html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">O</mi><mo stretchy=\"false\">(</mo><msup><mi>h</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathcal{O}(h^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"N5D8tcZTfn"},{"type":"text","value":"). That is, as we refine the mesh, our approximation of the divergence should improve by a factor of 2.","key":"psK0ynyOkk"}],"key":"fvg83w4u1i"},{"type":"paragraph","position":{"start":{"line":434,"column":0},"end":{"line":439,"column":0}},"children":[{"type":"text","value":"SimPEG has a number of testing functions for\n","key":"md3up5UR1g"},{"type":"link","url":"http://docs.simpeg.xyz/content/api_core/api_Tests.html#SimPEG.Tests.checkDerivative","children":[{"type":"text","value":"derivatives","key":"Z12kI5EWlL"}],"urlSource":"http://docs.simpeg.xyz/content/api_core/api_Tests.html#SimPEG.Tests.checkDerivative","key":"O1dbxPIaYb"},{"type":"text","value":"\nand\n","key":"fsjEaaPJJ7"},{"type":"link","url":"http://docs.simpeg.xyz/content/api_core/api_Tests.html#SimPEG.Tests.OrderTest","children":[{"type":"text","value":"order of convergence","key":"EtUE7zHJaU"}],"urlSource":"http://docs.simpeg.xyz/content/api_core/api_Tests.html#SimPEG.Tests.OrderTest","key":"zakQ48BB0t"},{"type":"text","value":"\nto make our lives easier!","key":"vlFQoZSpZf"}],"key":"p7ZmIec5Sk"}],"data":{"id":"nb-cell-33","type":"notebook-content","iooxa":{"id":{"block":"dWKbp4GkcXQLBCFELURo","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-33","label":"nb-cell-33","html_id":"nb-cell-33","key":"mjJmGckehj"},{"type":"block","position":{"start":{"line":440,"column":0},"end":{"line":441,"column":0}},"children":[{"type":"code","lang":"python","executable":true,"value":"import unittest\nfrom discretize.tests import OrderTest\n\njx = lambda x, y: -np.sin(2*np.pi*x)\njy = lambda x, y: -np.sin(2*np.pi*y)\nsol = lambda x, y: -2*np.pi*(np.cos(2*np.pi*x)+np.cos(2*np.pi*y))\n\nclass Testify(OrderTest):\n    meshDimension = 2\n    \n    def getError(self):\n        j = np.r_[jx(self.M.gridFx[:,0], self.M.gridFx[:,1]),\n                  jy(self.M.gridFy[:,0], self.M.gridFy[:,1])]\n        num = self.M.face_divergence * j # numeric answer\n        ans = sol(self.M.gridCC[:,0], self.M.gridCC[:,1]) # note M is a 2D mesh\n        return np.linalg.norm((num - ans), np.inf) # look at the infinity norm \n                                                   # (as we refine the mesh, the number of cells \n                                                   # changes, so need to be careful if using a 2-norm)\n    def test_order(self):\n        self.orderTest()\n\n# This just runs the unittest:\nsuite = unittest.TestLoader().loadTestsFromTestCase( Testify )\nunittest.TextTestRunner().run( suite );","identifier":"nb-cell-34-code","enumerator":"17","html_id":"nb-cell-34-code","key":"IHVeMaNybv"},{"type":"output","id":"RhIeAIItqVupMnqrRLbf2","data":[{"name":"stderr","output_type":"stream","text":"/opt/anaconda3/envs/simpeg/lib/python3.8/site-packages/discretize/utils/code_utils.py:247: FutureWarning: setupMesh has been deprecated, please use setup_mesh. It will be removed in version 1.0.0 of discretize.\n  warnings.warn(\n."},{"name":"stdout","output_type":"stream","text":"\nuniformTensorMesh:  Order Test\n_____________________________________________\n   h  |    error    | e(i-1)/e(i) |  order\n~~~~~~|~~~~~~~~~~~~~|~~~~~~~~~~~~~|~~~~~~~~~~\n   4  |  8.86e-01   |\n   8  |  2.96e-01   |   2.9914    |  1.5808\n  16  |  7.90e-02   |   3.7462    |  1.9054\n  32  |  2.01e-02   |   3.9364    |  1.9769\n---------------------------------------------\nHappy little convergence test!\n\n"},{"name":"stderr","output_type":"stream","text":"\n----------------------------------------------------------------------\nRan 1 test in 0.010s\n\nOK\n"}],"identifier":"nb-cell-34-output","html_id":"nb-cell-34-output","key":"Ry1N8xEPmI"}],"data":{"id":"nb-cell-34","type":"notebook-code","collapsed":false,"iooxa":{"id":{"block":"0ZarfpVD1EGskE5RVnpW","project":"5dxSs15hZtvQDKSzFgjP","version":1},"outputId":{"block":"FUMd7pX0BXnAPYI9k5Ms","project":"5dxSs15hZtvQDKSzFgjP","version":1}},"jupyter":{"outputs_hidden":false}},"identifier":"nb-cell-34","label":"nb-cell-34","html_id":"nb-cell-34","key":"rdLHvJGbxC"},{"type":"block","position":{"start":{"line":473,"column":0},"end":{"line":474,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":475,"column":0},"end":{"line":476,"column":0}},"children":[{"type":"text","value":"Looks good - Second order convergence!","key":"bsnVIWxzxC"}],"key":"Bdtu0n5riN"}],"data":{"id":"nb-cell-35","type":"notebook-content","iooxa":{"id":{"block":"GB24Nl2vYn6DUpUuA73D","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-35","label":"nb-cell-35","html_id":"nb-cell-35","key":"Ki6snUcJDD"},{"type":"block","position":{"start":{"line":477,"column":0},"end":{"line":478,"column":0}},"children":[{"type":"paragraph","position":{"start":{"line":479,"column":0},"end":{"line":480,"column":0}},"children":[{"type":"strong","children":[{"type":"text","value":"Next up...","key":"XfJmt3W6W7"}],"key":"v9m6YrPBlz"}],"key":"WGEidn0sH5"},{"type":"paragraph","position":{"start":{"line":481,"column":0},"end":{"line":482,"column":0}},"children":[{"type":"text","value":"In the ","key":"qpc9FqFHLt"},{"type":"link","url":"/weak-formulation","children":[{"type":"text","value":"next notebook","key":"lQb2NdhHk7"}],"urlSource":"weak-formulation.ipynb","internal":true,"dataUrl":"/weak-formulation.json","protocol":"file","key":"uDxiaTEFYE"},{"type":"text","value":", we will explore how to use the weak formulation to discretize the DC equations.","key":"cvj5dZlR1c"}],"key":"mTK0BxYdvM"}],"data":{"id":"nb-cell-36","type":"notebook-content","iooxa":{"id":{"block":"idngyxmrLM3e3YKsmEZC","project":"5dxSs15hZtvQDKSzFgjP","version":1}}},"identifier":"nb-cell-36","label":"nb-cell-36","html_id":"nb-cell-36","key":"ExQx78FQNT"}],"key":"xwSuIGY0yb"},"references":{"cite":{"order":[],"data":{}}},"footer":{},"domain":"http://localhost:3000"}